var wxinit=null;var satinit=null;var svinit=null;var statinit=null;var init=null;var t=document.getElementsByTagName("script");var _WXROOTURL=t[t.length-1].src.replace(/\\/g,"/").replace(/\/[^\/]*\/?$/,"");if(_WXROOTURL==""){_WXROOTURL="http://www.wxtiles.com"}var datedays=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];var datemonths=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var timekey={an:"Annual",m01:"January",m02:"February",m03:"March",m04:"April",m05:"May",m06:"June",m07:"July",m08:"August",m09:"September",m10:"October",m11:"November",m12:"December"};function zer0(a){if(String(a).length<2){a="0"+a}return a}extendTo=function(a,e){a=a||{};if(e){for(var d in e){var c=e[d];if(c!==undefined){a[d]=c}}var b=typeof window.Event=="function"&&e instanceof window.Event;if(!b&&e.hasOwnProperty&&e.hasOwnProperty("toString")){a.toString=e.toString}}return a};Object.keys=Object.keys||function(c){var a=[];for(var b in c){if(c.hasOwnProperty(b)){a.push(b)}}return a};if(!Array.prototype.indexOf){Array.prototype.indexOf=function(c,d){for(var b=(d||0),a=this.length;b<a;b++){if(this[b]===c){return b}}return -1}}_WXTiles={name:"Weather overlay",isBaseLayer:false,wrapDateLine:true,minZoom:1,maxZoom:14,views:null,colorBar:null,map:null,cview:"none",ctime:-1,strtime:".",cycle:null,autoupdate:true,isinit:false,hidden:false,ext:".png",tselect:null,vselect:null,withnone:false,toff:-99,type:"",linklayers:false,buffer:0,updateCallback:null,vorder:[],attribution:'<div><a target="_blank" href="http://www.wxtiles.com"><img src="'+_WXROOTURL+'/../images/wxtiles_48.png" /><br><span>WXTiles</span></a></div>',initialize:function(b){this._url=_WXROOTURL+"/../ajr/";if(!(this._url.charAt(this._url.length-1)=="/")){this._url+="/"}extendTo(this,b);this._srv=this._url;this._serverlist={};this.lastinit=new Date();if(this.autoupdate){var c=this;setInterval(function(){c._loadinit()},600000)}if(this.toff==-99){var a=new Date();this.toff=-a.getTimezoneOffset()/60}this.times={};this.alpha=(b&&b.alpha)?b.alpha:{};this.meta={};this.alltimes=[];this.views={};this.setVisibility(false);this._loadinit()},_loadinit:function(){eval("thisinit=null;");this.isinit=false;var oldscript=document.getElementById(this.type+"init");if(oldscript){document.body.removeChild(oldscript)}var script=document.createElement("script");script.setAttribute("id",this.type+"init");script.setAttribute("src",this._url+this.type+"init?domain="+document.domain+"&"+Math.random());script.setAttribute("type","text/javascript");document.body.appendChild(script);this._init()},_init:function(){if(!this.isinit){eval("var thisinit="+this.type+"init;");if(thisinit){thisinit(this);this.getTimes();if(!this.vorder.length){this.vorder=Object.keys(this.views)}if(this.withnone){this.views.none="None";this.times.none=[];this.alpha.none=0;if(this.vorder.indexOf&&this.vorder.indexOf("none")<0){this.vorder=["none"].concat(this.vorder)}}if(!this.views[this.cview]){for(var i=0;i<this.vorder.length;i++){if(this.views[this.vorder[i]]){this.cview=this.vorder[i];break}}}this._makeVSelect(this.vorder);this.setView(this.cview);if(this.getTimes(false,true).indexOf(this.ctime)<0){this.ctime=false}this.setTime(this.ctime);this._makeTSelect();this.isinit=true;this.lastinit=new Date();if(this.updateCallback){this.updateCallback.apply(this)}}else{var thisinst=this;setTimeout(function(){thisinst._init()},100)}}},_updateOpacity:function(){opacity=this.alpha[this.cview];this._setOpacity(opacity?opacity:this.defalpha?this.defalpha[this.cview]:1)},_update:function(){if(!this.times[this.cview]){this.setVisibility(false);return}for(var a=0;a<this.times[this.cview].length;a++){if(this.times[this.cview][a]==this.ctime|this.times[this.cview][a]==-1){break}}if(!this.hidden&&a<this.times[this.cview].length){this.setVisibility(true)}else{this.setVisibility(false)}this._setURL();this._updateOpacity();if(this.colorBar){this.colorBar.update(this.hidden?"none":this.cview,this._srv)}this.redraw()},_setURL:function(){var a=this.cview;var c=this._getZoom();for(s in this._serverlist){var b=s.split("_");if(b[0]=="*"|b[0]==a){if(b[1]=="*"|b[1]==c){this._srv=this._serverlist[s];return}}}},addToMap:function(a){},addColorBar:function(d,c,b){var a=d?d:"big";var e=c?c:"horiz";this.colorBar=new WXColorBar({size:a,orientation:e,location:b});if(this.map){this.colorBar.addToMap(this.map)}this.colorBar.update(this.cview,this._srv);return this.colorBar},getVSelect:function(a){return this._makeVSelect(a?a:this.vorder)},getTSelect:function(a){return this._makeTSelect(a)},linkTime:function(b,a){if(!this.linklayers){this.linklayers=[]}this.linklayers.push(b);if(!a){b.linkTime(this,true)}},hide:function(){this.hidden=true;this._update()},show:function(){this.hidden=false;this._update()},getTimes:function(a,f){this.alltimes=[];var b={};var h=[this];if(f){h.concat(this.linklayers)}for(var c=0;c<h.length;c++){for(v in this.views){if(!this.times[v]){continue}for(var d=0;d<this.times[v].length;d++){var e=this.times[v][d];b[e]=1}}}for(e in b){var g=parseInt(e);this.alltimes.push(isNaN(g)?e:g)}this.alltimes.sort();return(a)?this.times[a]:this.alltimes},getCycle:function(){return this.cycle},getViews:function(){return this.views},setView:function(a){if(this.views[a]){this.cview=a;this._update();return this.cview}return false},setTime:function(a,c){if(!a){var b=new Date();dt=this.alltimes.length>1?this.alltimes[1]-this.alltimes[0]:0;a=b.valueOf()-dt}if(typeof(a)=="object"){a=a.valueOf()}newtime=parseInt(a);if(isNaN(newtime)){if(this.alltimes.indexOf(a)<0){a=this.alltimes[0]}this.strtime=a;this.ctime=a}else{for(var e=0;e<this.alltimes.length;e++){if(this.alltimes[e]>=newtime){newtime=this.alltimes[e];break}}this.ctime=newtime;if(e<this.alltimes.length){if(this.ctime<0){this.strtime="."}else{var d=new Date(this.ctime);this.strtime=""+d.getUTCFullYear()+zer0(d.getUTCMonth()+1)+zer0(d.getUTCDate())+"_"+zer0(d.getUTCHours())+"z"}}}if(this.linklayers&&!c){for(e=0;e<this.linklayers.length;e++){this.linklayers[e].setTime(newtime,true)}}this._update();return newtime},setToffset:function(a){this.toff=a;this._makeTSelect()},setAlpha:function(c,a){if(a){this.alpha[a]=c}else{for(var b=0;b<this.vorder.length;b++){this.alpha[this.cview]=c}}this._updateOpacity()},_makeVSelect:function(a){if(!this.vselect){this.vselect=document.createElement("Select");this.vselect.setAttribute("name",this.id+"_vSelect")}if(!this.views){return null}this.vselect.length=0;for(i=0;i<a.length;i++){if(this.views[a[i]]){this.vselect.options[this.vselect.options.length]=new Option(this.views[a[i]],a[i],(a[i]==this.cview),(a[i]==this.cview))}}this.vselect.onchange=(function(c,b){return function(d){return b.apply(c,[this.value])}})(this,this.setView);return this.vselect},_makeTSelect:function(b){if(!this.tselect|b){this.tselect=document.createElement("Select");this.tselect.setAttribute("name",this.id+"_tSelect")}this.tselect.length=0;var d=this.getTimes(false,true);for(i=0;i<d.length;i++){var c=d[i];if(typeof(c)=="string"){var a=timekey[c]}else{var e=new Date(c+this.toff*3600000);var a=datedays[e.getUTCDay()]+" "+e.getUTCDate()+" "+datemonths[e.getUTCMonth()]+" "+zer0(e.getUTCHours())+":"+zer0(e.getUTCMinutes())}this.tselect.options[this.tselect.options.length]=new Option(a,c,(c==this.ctime),(c==this.ctime))}this.tselect.onchange=(function(g,f){return function(h){return f.apply(g,[this.value])}})(this,this.setTime);return this.tselect},addToMap:function(a){},removeFromMap:function(){},setVisibility:function(a){},getMetaData:function(){if(this.cview=="None"){return Null}else{return this.meta[this.cview]}}};_WXColorBar={id:"WXColorBar",size:"big",orientation:"horiz",location:null,mpos:["TopRight","TopLeft","BottomRight","BottomLeft"],cview:null,initialize:function(a){extendTo(this,a);this.imurl="{url}{v}/{v}_"+this.size+"_"+this.orientation+".png"},addToMap:function(a){},removeFromMap:function(){},update:function(a,b){if(!this.div){return}if(!a){a=this.cview}this.cview=a;if(a=="none"){this.div.style.display="none"}else{this.div.innerHTML='<img class="wxcolorbar" src="'+this.imurl.replace(/{v}/g,a).replace(/{url}/g,b)+'" />';this.div.style.display="block"}}};if(typeof(OpenLayers)!="undefined"){WXTiles=OpenLayers.Class(OpenLayers.Layer.TMS,_WXTiles,{mapz0:0,initialize:function(b){var a=(b&&b.name)?b.name:"WXTiles Overlay";OpenLayers.Layer.TMS.prototype.initialize.apply(this,[a,"",b]);_WXTiles.initialize.apply(this,[b])},getURL:function(d){if(!this.getVisibility()){return this.url+"none.png"}var c=this.map.getResolution();var e=this.map.getZoom()+this.mapz0;if(e>=this.minZoom&&e<=this.maxZoom){var a=Math.round((d.left-this.tileOrigin.lon)/(c*this.tileSize.w));var b=Math.pow(2,e);a=((a%b)+b)%b;var f=Math.round((d.bottom-this.tileOrigin.lat)/(c*this.tileSize.h));return this._srv+this.cview+"/"+this.strtime+"/"+e+"/"+a+"/"+f+this.ext}else{return this.url+"none.png"}},_update:function(){this.transitionEffect=null;_WXTiles._update.apply(this)},_getZoom:function(){return this.map.getZoom()},_setOpacity:function(a){this.setOpacity(a)},addToMap:function(a){a.setOptions({projection:new OpenLayers.Projection("EPSG:900913"),units:"m",maxResolution:156543.0339,maxExtent:new OpenLayers.Bounds(-20037509,-20037508.34,20037508.34,20037508.34)});a.addLayers([this]);if(a.getControlsByClass("OpenLayers.Control.Attribution").length==0){this.attrib=new OpenLayers.Control.Attribution();a.addControl(this.attrib);this.attrib.div.style.bottom="10px"}a.events.register("movestart",this,this._setURL);if(typeof this.map.baseLayer.minZoomLevel!="undefined"){this.mapz0=this.map.baseLayer.minZoomLevel}},removeFromMap:function(){if(this.map.getLayersByClass("WXTiles").length==0){this.map.removeControl(this.attrib)}this.map.removeControl(this.colorBar);this.map.removeLayer(this)},setVisibility:function(a){OpenLayers.Layer.TMS.prototype.setVisibility.apply(this,[a])},CLASS_NAME:"WXTiles"});WXColorBar=OpenLayers.Class(OpenLayers.Control,_WXColorBar,{initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,[a]);_WXColorBar.initialize.apply(this,[a])},draw:function(a){OpenLayers.Control.prototype.draw.apply(this,[a]);if(!a){if(this.location=="TopLeft"){this.div.style.left=20+"px";this.div.style.top=10+"px"}else{if(this.location=="BottomLeft"){this.div.style.left=20+"px";this.div.style.bottom=10+"px"}else{if(this.location=="BottomRight"){this.div.style.right=20+"px";this.div.style.bottom=10+"px"}else{this.div.style.right=20+"px";this.div.style.top=10+"px"}}}}return this.div},addToMap:function(a){a.addControl(this)},removeFromMap:function(){map.removeControl(this)},CLASS_NAME:"WXColorBar"})}else{if(typeof(google)!="undefined"){GMWXTiles={tileSize:new google.maps.Size(256,256),index:0,attrib:-1,calpha:1,getTile:function(e,c,b){var d=this.index+"_"+e.x+"_"+e.y;for(i=0;i<this.tiles.length;i++){if(this.tiles[i].id==d){var a=this.tiles[i];break}}if(i==this.tiles.length){var a=b.createElement("IMG");a.id=d;a.style.width="256px";a.style.height="256px";this.tiles.push(a)}if(!this.visible){a.style.display="none"}else{a.src=this.getTileUrl(e,c);a.style.display="";if(typeof(a.style.filter)=="string"){a.style.filter="alpha(opacity:"+this.calpha+")"}if(typeof(a.style.KHTMLOpacity)=="string"){a.style.KHTMLOpacity=this.calpha}if(typeof(a.style.MozOpacity)=="string"){a.style.MozOpacity=this.calpha}if(typeof(a.style.opacity)=="string"){a.style.opacity=this.calpha}}return a},getTileUrl:function(e,c){if(c>=this.minZoom&&c<=this.maxZoom){var a=e.x%(1<<c);var b=Math.pow(2,c);var d=b-1-e.y;return this._srv+this.cview+"/"+this.strtime+"/"+c+"/"+a+"/"+d+this.ext}else{return this.url+"none.png"}},setVisibility:function(a){this.visible=a},_setOpacity:function(a){this.calpha=a},_getZoom:function(){return this.map.getZoom()},redraw:function(){var a=this.map.getZoom();if((a-1)>=this.map.minZoom){this.map.setZoom(a-1)}else{this.map.setZoom(a+1)}this.map.setZoom(a)},addToMap:function(d){this.map=d;this.tiles=new Array();d.overlayMapTypes.push(this);this.index=d.overlayMapTypes.length-1;this.id="WXTiles_"+this.index;if(!this.map.has_wxtiles_attrib){var a=document.createElement("DIV");a.innerHTML=this.attribution;a.id="wxtiles_attrib";a.style.bottom="20px";this.map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(a);this.attrib=this.map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].length-1;this.map.has_wxtiles_attrib=true}var c=this;var b=(function(){return function(){c._setURL.apply(c,[])}})();google.maps.event.addListener(d,"zoom_changed",b)},removeFromMap:function(b){this.map.overlayMapTypes.removeAt(this.index);this.colorBar.removeFromMap();var a=false;if(b){return}this.map.overlayMapTypes.forEach(function(c){a=(c instanceof WXTiles)|a});if(!a){this.map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].removeAt(this.attrib)}}};var WXTiles=(function(){var a=function(d,c){this.initialize.apply(this,[d,c])};var b={};extendTo(b,_WXTiles);extendTo(b,GMWXTiles);a.prototype=b;return a})();GMWXColorBar=function(){this.div=document.createElement("DIV");this.div.style.padding="4px";this.div.index=1};WXColorBar=function(a){var b=new GMWXColorBar();extendTo(b,_WXColorBar);extendTo(b,{addToMap:function(c){if(this.location=="TopLeft"){c.controls[google.maps.ControlPosition.TOP_LEFT].push(this.div);this.index=c.controls[google.maps.ControlPosition.TOP_LEFT].length-1}else{if(this.location=="BottomLeft"){c.controls[google.maps.ControlPosition.LEFT_BOTTOM].push(this.div);this.index=c.controls[google.maps.ControlPosition.LEFT_BOTTOM].length-1}else{if(this.location=="BottomRight"){c.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(this.div);this.index=c.controls[google.maps.ControlPosition.RIGHT_BOTTOM].length-1}else{c.controls[google.maps.ControlPosition.TOP_RIGHT].push(this.div);this.index=c.controls[google.maps.ControlPosition.TOP_RIGHT].length-1}}}this.map=c},removeFromMap:function(){if(this.location=="TopLeft"){this.map.controls[google.maps.ControlPosition.TOP_LEFT].removeAt(this.index)}else{if(this.location=="BottomLeft"){this.map.controls[google.maps.ControlPosition.LEFT_BOTTOM].removeAt(this.index)}else{if(this.location=="BottomRight"){this.map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].removeAt(this.inex)}else{this.map.controls[google.maps.ControlPosition.TOP_RIGHT].removeAt(this.index)}}}}});b.initialize(a);return b}}};